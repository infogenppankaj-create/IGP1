<!-- Start content -->
<div class="content">
    <div class="container-fluid">
        <label for="inputCity" class="col-form-label"></label>
        <!-- Form row -->
        <div class="row">
                <div class="col-8">
                    <div class="form-row">
                        <div class="form-group col-md-8">
                            <label for="Name" class="col-form-label">Tariff </label>
                            <select id="cmbTariff" name="cmbTariff_n" class="form-control select2"></select>
                        </div>

                        <div class="form-group col-md-4">
                            <label for="Name" class="col-form-label">Service Category </label>
                            <select id="cmbServiceCategory" name="cmbServiceCategory_n" class="form-control select2"></select>
                        </div>

                        <div class="form-group col-md-8">
                            <label for="Name" class="col-form-label">Service </label>
                            <select id="cmbService" name="cmbService_n" class="form-control select2"></select>
                        </div>
   
                        <div class="form-group col-md-4">
                            <label for="Name" class="col-form-label">Effective Date</label>
                            <input type="date" id="dtFrom" name="dtFrom_n" class="form-control" placeholder="">
                        </div>  

                    </div>                    
                </div>

                <div class="col-4">
                    <div class="form-row">             
                        <div class="form-group col-md-6">
                            <label for="Name" class="col-form-label">Service Category </label>
                            <input type="text" id="txtServiceCategory" name="txtServiceCategory_n" class="form-control" autocomplete="off" placeholder="">
                        </div>

                        <div class="form-group col-md-6">
                            <label for="Name" class="col-form-label">Tariff </label>
                            <input type="text" id="txtTariff" name="txtTariff_n" class="form-control" autocomplete="off" placeholder="">
                        </div>

                        <div class="form-group col-md-12">
                            <label for="Name" class="col-form-label">Service </label>
                            <input type="text" id="txtService" name="txtService_n" class="form-control" autocomplete="off" placeholder="">
                        </div> 
                    </div>                    
                </div>

                <div class="col-8">                    
                    <div class="form-row">
                        <div class="card-box table-responsive">
                            <h4 class="m-t-0 header-title"><b>All Service Charges</b></h4>
                            <p class="text-muted font-13 m-b-30">
                            </p>
                            <table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th style="width:5%">ID</th>
                                        <th>SERVICE ID</th>
                                        <th>TARIFF ID</th>
                                        <th>SERVICE CATEGORY ID</th>
                                        <th>STATUS ID</th>
                                        <th>TARIFF</th>
                                        <th>CATEGORY </th>
                                        <th>SERVICE</th>
                                        <th>SERVICE AMOUNT</th> 
                                        <th>SERVICE CHARGE</th>
                                        <th>H CHARGE</th>
                                        <th>DR CHARGE</th>
                                        <th>OTH CHARGE</th>
                                        <th>TAX</th> 
                                        <th>DISC</th>    
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>                        
                    </div>      

                    <div class="form-row" style="display: none;">                      
                        <div class="form-group col-md-3">     
                            <label for="Name" class="col-form-label">&nbsp;</label>                             
                            <input type="text" id="txtID" name="txtID_n" class="form-control" autocomplete="off" placeholder="" required>
                            {{!-- <input type="text" id="txtID" name="txtID_n" class="form-control" autocomplete="off" placeholder=""> --}}
                        </div>

                        <div class="form-group col-md-3">     
                            <label for="Name" class="col-form-label">&nbsp;</label>                             
                            <input type="text" id="txtServiceID" name="txtServiceID_n" class="form-control" autocomplete="off" placeholder="" required>
                        </div>

                        <div class="form-group col-md-3">     
                            <label for="Name" class="col-form-label">&nbsp;</label>                             
                            <input type="text" id="txtTariffID" name="txtTariffID_n" class="form-control" autocomplete="off" placeholder="" required>
                        </div>

                        <div class="form-group col-md-3">     
                            <label for="Name" class="col-form-label">&nbsp;</label>                             
                            <input type="text" id="txtServiceCategoryID" name="txtServiceCategoryID_n" class="form-control" autocomplete="off" placeholder="" required>
                        </div>
                    </div>    
                </div>

                <div class="col-4">
                    <div class="form-row">    

                        <div class="form-group col-md-6">
                            <label for="Name" class="col-form-label">Service Charge </label>
                            <input type="text" id="txtSCharge" name="txtSCharge_n" class="form-control" autocomplete="off" placeholder="">
                        </div>

                        <div class="form-group col-md-6">
                            <label for="Status" class="col-form-label">Service Amount</label>
                            <input type="text" id="txtAmount" name="txtAmount_n" class="form-control" autocomplete="off" placeholder="" >
                        </div>                                                    

                        <div class="form-group col-md-4">
                            <label for="Name" class="col-form-label">Hospital Charge </label>
                            <input type="text" id="txtHCharge" name="txtHCharge_n" class="form-control" autocomplete="off" placeholder="" required>
                        </div>

                        <div class="form-group col-md-4">
                            <label for="Name" class="col-form-label">Dr. Charge </label>
                            <input type="text" id="txtDrCharge" name="txtDrCharge_n" class="form-control" autocomplete="off" placeholder="">
                        </div>

                        <div class="form-group col-md-4">
                            <label for="Status" class="col-form-label">Other Charge</label>
                            <input type="text" id="txtOCharge" name="txtOCharge_n" class="form-control" autocomplete="off" placeholder="">
                        </div>

                        <div class="form-group col-md-4">
                            <label for="Name" class="col-form-label">Service Tax %</label>
                            <input type="text" id="txtTax" name="txtTax_n" class="form-control" autocomplete="off" placeholder="">
                        </div>

                        <div class="form-group col-md-4">
                            <label for="Name" class="col-form-label">Service Disc %</label>
                            <input type="text" id="txtDisc" name="txtDisc_n" class="form-control" autocomplete="off" placeholder="">
                        </div>

                        <div class="form-group col-md-4">
                                <label for="Status" class="col-form-label">Status</label>
                                <select id="cmbStatus" name="cmbStatus_n" class="form-control select2"></select>
                        </div>
                    </div>                                 

                    <div class="form-row">    
                        <div class="form-group col-md-12">                            
                            <label for="Description" class="col-form-label">Description</label>
                            <textarea class="form-control" style="height: 100px;" id="txtDescription" name="txtDescription_n" rows="5"
                                placeholder=""></textarea>                        
                        </div>
                    </div>

                    <div class="form-row"> 
                        <div class="form-group col-md-6">
                            {{!-- <label for="Name" class="col-form-label">&nbsp;</label>   --}}
                            <div class="checkbox checkbox-custom">
                                <input id="chkTariff" type="checkbox">
                                <label for="chkTariff">
                                    &nbsp;Update for all Tariff 
                                </label>
                            </div>                             
                        </div>                        

                        <div class="form-group col-md-6">
                            {{!-- <label for="Name" class="col-form-label">&nbsp;</label>   --}}
                            <div class="checkbox checkbox-custom">
                                <input id="chkServiceCategory" type="checkbox">
                                <label for="chkServiceCategory">
                                    &nbsp;Update for all S.Category
                                </label>
                            </div>                             
                        </div>
                    </div>
                
                    <div class="form-row">      
                        <div class="form-group col-md-12">
                            <button id="btnsave" type="button" style="width: 100%;font-size: 18px;"
                                class="btn btn-primary btn-rounded w-md waves-effect waves-light">Save</button>
                        </div>
                    </div>
                </div>
        </div>

    </div> <!-- container -->
</div> <!-- content -->
<footer class="footer text-right">
</footer>

<script>
    var defaultdata = {{{ data1 }}};
    document.getElementById('dtFrom').valueAsDate = new Date();
    $('#lblFormName').html("ServiceCharge");
    $('#txtTariff').attr('disabled', true);
    $('#txtServiceCategory').attr('disabled', true);
    $('#txtSCharge').attr('disabled', true);
    $('#txtAmount').attr('disabled', true);  
    $('#txtService').attr('disabled', true);  
    $('#dtFrom').attr('disabled', true);

    //populate dropdown start
    var option = '';
    for (var i = 0; i < defaultdata.result.length; i++) {
        option += '<option value="' + defaultdata.result[i].ID + '">' + defaultdata.result[i].NAME + '</option>';
    }
    $('#cmbStatus').append(option);

    //
    var option = '';
    option += '<option value="0">SELECT</option>';
    for (var i = 0; i < defaultdata.Tariff.length; i++) {
        option += '<option value="' + defaultdata.Tariff[i].ID + '">' + defaultdata.Tariff[i].NAME + '</option>';
    }
    $('#cmbTariff').append(option);

    //
    var option = '';
    option += '<option value="0">SELECT</option>';
    for (var i = 0; i < defaultdata.Service.length; i++) {
        option += '<option value="' + defaultdata.Service[i].ID + '">' + defaultdata.Service[i].NAME + '</option>';
    }
    $('#cmbService').append(option);

    //
    var option = '';
    option += '<option value="0">SELECT</option>';
    for (var i = 0; i < defaultdata.ServiceCategory.length; i++) {
        option += '<option value="' + defaultdata.ServiceCategory[i].ID + '">' + defaultdata.ServiceCategory[i].NAME + '</option>';
    }
    $('#cmbServiceCategory').append(option);

    $(function () {    
        // Form Load event     
        //$('#txtTariff').attr('disabled', true);
        //$('#txtServiceCategory').attr('disabled', true);
        //$('#txtService').attr('disabled', true);
        //$('#txtID').attr('disabled', true);            
    });

        //
    $(function () {
        //Combo selection option
        $("#cmbTariff").change(function () {
            bindGrid();
            $("#example").dataTable().fnDestroy();
            //
            //$('#lblError').html('');
            //bindData() 
        });

        //Combo selection option
        $("#cmbService").change(function () {
            bindGrid();
            $("#example").dataTable().fnDestroy();
        });
        
        //Combo selection option
        $("#cmbServiceCategory").change(function () {
            bindGrid();
            $("#example").dataTable().fnDestroy();
        });
    });

    //Save event
   

    $("#btnsave").on("click", function () {    
        var inpObj1 = document.getElementById("txtHCharge"); 
        var inpObj2 = document.getElementById("txtID");
        var inpObj3 = document.getElementById("txtTariffID");
        var inpObj4 = document.getElementById("txtServiceID");
        var inpObj5 = document.getElementById("txtServiceCategoryID");
        if (!inpObj1.checkValidity() || !inpObj2.checkValidity() || !inpObj3.checkValidity() || !inpObj4.checkValidity() || !inpObj5.checkValidity()) {
            alert("Please fill in the required fields:");
        }
        else {  
            $('#lblError').html('');
            if ($("#txtHCharge").val() === '') {
                $('#txtHCharge').val("0");
            }
            if ($("#txtDrCharge").val() === '') {
                $('#txtDrCharge').val("0");
            }
            if ($("#txtOCharge").val() === '') {
                $('#txtOCharge').val("0");
            }            
            if ($("#txtTax").val() === '') {
                $('#txtTax').val("0");
            }
            if ($("#txtDisc").val() === '') {
                $('#txtDisc').val("0");
            }            
            var data = {
                "IN_USER_ID": "0",
                "IN_BRANCH_ID": "0",
                "IN_ID": $("#txtID").val(),
                "IN_TARIFF_ID": $("#txtTariffID").val(),
                "IN_SERVICE_ID": $("#txtServiceID").val(),
                "IN_SERVICE_CATEGORY_ID": $("#txtServiceCategoryID").val(),
                "IN_DR_CHARGE": $("#txtDrCharge").val(),
                "IN_H_CHARGE": $("#txtHCharge").val(),
                "IN_OTH_CHARGE": $("#txtOCharge").val(),
                "IN_SERVICE_TAX": $("#txtTax").val(), 
                "IN_SERVICE_DISC": $("#txtDisc").val(),
                "IN_FOR_ALL_TARIFF": $("#chkTariff").is(":checked"), 
                "IN_FOR_ALL_SERVICE_CATEGORY": $("#chkServiceCategory").is(":checked"), 
                "IN_DESCRIPTION": $("#txtDescription").val(),
                "IN_STATUS": $("#cmbStatus").val(),
            }
            //console.log("data",  data)
            $.ajax({
                url: 'saveServiceCharge',
                type: "POST",
                data: JSON.stringify(data),
                dataType: 'json',
                contentType: 'application/json',
                success: function (data) {
                    if (data.message == 0)
                    {
                        alert("Save Error!!");   
                        return false;                     
                    }
                    else
                    {
                        alert("Save Successfully.");
                        //window.location.reload(true);
                        //
                        bindGrid();
                        $("#example").dataTable().fnDestroy();  
                    }                     

                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                    }
                    alert(msg);
                    return false;
                }
            });       
        }    
    });

    //
    $(document).ready(function () {
        bindGrid();
        $("#example").dataTable().fnDestroy();
    });

    //

    //
    $(function () {        
        $('#example tbody').on( 'click', 'tr',  (event) =>  {
            var table = $('#example').DataTable();
            if ($(event.currentTarget).hasClass('selected')) {
                $(event.currentTarget).removeClass('selected');
            }
            else {
                table.rows('.selected').nodes().each((row) => row.classList.remove('selected'));
                $(event.currentTarget).addClass('selected');
            }
            //console.log( table.row( event.currentTarget ).data() );
                var gridData = table.row( event.currentTarget ).data();
                $('#txtID').val(gridData.ID);
                $('#txtServiceID').val(gridData.SERVICE_ID);
                $('#txtTariffID').val(gridData.TARIFF_ID);
                $('#txtServiceCategoryID').val(gridData.SERVICE_CATEGORY_ID);
                $('#cmbStatus').val(gridData.STATUS_ID).change();
                $('#txtTariff').val(gridData.TARIFF);
                $('#txtServiceCategory').val(gridData.SERVICE_CATEGORY);
                $('#txtService').val(gridData.SERVICE);                        
                $('#txtSCharge').val(gridData.SERVICE_CHARGE);
                $('#txtAmount').val(gridData.SERVICE_AMOUNT);                        
                $('#txtHCharge').val(gridData.H_CHARGE);
                $('#txtDrCharge').val(gridData.DR_CHARGE);
                $('#txtOCharge').val(gridData.OTH_CHARGE);
                $('#txtTax').val(gridData.ORG_TAX_P);
                $('#txtDisc').val(gridData.ORG_DISC_P);
                //console.log(table.row( this ).data());
                $("#example1").dataTable().fnDestroy();
        } );        
    }); 

    function bindGrid() {
        $('#txtID').val("0");
        $('#txtServiceID').val("0");
        $('#txtTariffID').val("0");
        $('#txtServiceCategoryID').val("0");
        $('#cmbStatus').val("0").change();
        $('#txtTariff').val("");
        $('#txtServiceCategory').val("");
        $('#txtService').val("");                        
        $('#txtSCharge').val("");
        $('#txtAmount').val("");                        
        $('#txtHCharge').val("");
        $('#txtDrCharge').val("");
        $('#txtOCharge').val("");
        $('#txtTax').val("");
        $('#txtDisc').val("");

        var data = {
            IN_USER_ID: "0",
            IN_CLIENT_ID: "0",
            IN_SERVICE_ID: $("#cmbService").val(),
            IN_TARIFF_ID: $("#cmbTariff").val(),
            IN_SERVICE_CATEGORY_ID: $("#cmbServiceCategory").val(),
            IN_ID: "0",
            IN_STATUS: "0"                           
        };
        $.ajax({
            url: 'getServiceChargeGrd',
            type: "POST",
            data: JSON.stringify(data),
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                if (data.message == 0)
                    alert("Invalid User.");
                else {
                    dataSet = data;
                    $('#example').DataTable({
                        //*****Start
                        //"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        "order": [0, "desc"], // Order data
                        "scrollX": true,
                        //"scrollY": "500px", //Paging enable disable
                        //"scrollCollapse": true,//Scroll enable disable
                        //"paging": false, //Paging enable disable
                        //"pagingType": "full_numbers", showing all page numbers
                        //stateSave: true,
                        //*****End                                               
                        data: dataSet,
                        columns: [                        
                            { data: "ID" },
                            { data: "SERVICE_ID"}, 
                            { data: "TARIFF_ID"}, 
                            { data: "SERVICE_CATEGORY_ID"}, 
                            { data: "STATUS_ID"}, 
                            { data: "TARIFF"},
                            { data: "SERVICE_CATEGORY"},
                            { data: "SERVICE"},
                            { data: "SERVICE_AMOUNT"},
                            { data: "SERVICE_CHARGE"},  
                            { data: "H_CHARGE"},
                            { data: "DR_CHARGE"},                            
                            { data: "OTH_CHARGE"},
                            { data: "ORG_TAX_P"},
                            { data: "ORG_DISC_P"},                             
                        ],
                        "columnDefs": [
                            {
                                "targets": [0],
                                "visible": false,
                                //"searchable": false
                            },
                            {
                                "targets": [1],
                                "visible": false,
                            },
                            {
                                "targets": [2],
                                "visible": false,
                            },
                            {
                                "targets": [3],
                                "visible": false,
                            },
                            {
                                "targets": [4],
                                "visible": false,
                            },
                            {
                                "targets": [10],
                                "visible": false,
                            },
                            {
                                "targets": [11],
                                "visible": false,
                            },
                            {
                                "targets": [12],
                                "visible": false,
                            }                            
                        ]                        
                        // implemented export option
                        //, dom: 'Bfrtip',
                        //buttons: [
                        //    'excel', 'pdf'
                        //],
                                                 
                    });
                    /*
                    var table = $('#example').DataTable();

                    $('#example tbody').on('click', 'tr', function () {
                        if ($(this).hasClass('selected')) {
                            $(this).removeClass('selected');
                        }
                        else {
                            table.$('tr.selected').removeClass('selected');
                            $(this).addClass('selected');
                        }
                        //Populating textbox after row grid select
                        var gridData = table.row( this ).data();
                        
                    });
                    */
                }
            }
        });
    }
   
</script>